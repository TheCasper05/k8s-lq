version: '3.8'

services:
  # Student-Teacher App (Nuxt 4)
  student-teacher:
    build:
      context: .
      dockerfile: apps/student-teacher/Dockerfile
    container_name: lq-student-teacher
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NUXT_PUBLIC_GRAPHQL_ENDPOINT=${NUXT_PUBLIC_GRAPHQL_ENDPOINT:-http://localhost:4000/graphql}
      - NUXT_PUBLIC_GRAPHQL_WS_ENDPOINT=${NUXT_PUBLIC_GRAPHQL_WS_ENDPOINT:-ws://localhost:4000/graphql}
      - NUXT_PUBLIC_SENTRY_DSN=${NUXT_PUBLIC_SENTRY_DSN:-}
      - NUXT_PUBLIC_SENTRY_ENVIRONMENT=${NUXT_PUBLIC_SENTRY_ENVIRONMENT:-production}
    restart: unless-stopped
    networks:
      - lq-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Institutional App (Vue + Vite)
  institutional:
    build:
      context: .
      dockerfile: apps/institutional/Dockerfile
    container_name: lq-institutional
    ports:
      - "8080:80"
    restart: unless-stopped
    networks:
      - lq-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:80/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  lq-network:
    driver: bridge

# Development override example
# Create a docker-compose.override.yml file for development-specific settings
