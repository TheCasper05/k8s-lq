# Internationalization (i18n) Guide

Complete guide to using the i18n system in LingoQuesto monorepo.

**Status**: âœ… **Production Ready** | **Version**: 1.0.0 | **Last Updated**: November 21, 2025

## ğŸ¯ Quick Stats

- **Languages**: 6 (EN, ES, AR, FR, DE, ZH)
- **Translations**: 1,626 (100% complete)
- **Type Safety**: âœ… Auto-generated TypeScript types
- **Automation**: âœ… Key extraction, validation, type generation
- **Unit Tests**: 60 tests, 100% passing
- **RTL Support**: âœ… Full Arabic support

## Table of Contents

- [Overview](#overview)
- [Architecture](#architecture)
- [Basic Usage](#basic-usage)
- [Medium Usage](#medium-usage)
- [Advanced Usage](#advanced-usage)
- [Scripts & Tooling](#scripts--tooling)
- [Best Practices](#best-practices)
- [Troubleshooting](#troubleshooting)

---

## Overview

LingoQuesto uses a hybrid i18n architecture:

- **Shared utilities** via `@lq/i18n` package (configuration, RTL support, persistence)
- **App-specific translations** managed independently by each application
- **6 supported languages**: English (EN), Spanish (ES), Arabic (AR), French (FR), German (DE), Chinese (ZH)
- **RTL support** for Arabic with automatic document direction switching

### Why This Architecture?

We initially attempted to centralize all translations in the `@lq/i18n` package, but encountered bundler limitations:

- **Vite** (institutional app) and **Nuxt** (student-teacher app) have different module resolution strategies
- **Lazy loading** in Nuxt requires specific file structures that conflict with workspace imports
- **Build optimization** and **HMR** work better with co-located translation files

**Solution**: Use `@lq/i18n` for shared configuration and utilities, while each app manages its own translation files.

---

## Architecture

### Package Structure

```
frontend-lq/
â”œâ”€â”€ packages/i18n/                    # Shared utilities package
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config.ts                 # Locale configuration
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ rtl.ts                # RTL support utilities
â”‚   â”‚   â”‚   â””â”€â”€ persistence.ts        # Locale storage utilities
â”‚   â”‚   â”œâ”€â”€ composables/
â”‚   â”‚   â”‚   â””â”€â”€ useLocaleSwitch.ts    # Vue composable
â”‚   â”‚   â””â”€â”€ index.ts                  # Package entry point
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ apps/institutional/               # Vue 3 + Vite app
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ locales/                  # Translation files
â”‚       â”‚   â”œâ”€â”€ en.ts
â”‚       â”‚   â”œâ”€â”€ es.ts
â”‚       â”‚   â”œâ”€â”€ ar.ts
â”‚       â”‚   â”œâ”€â”€ fr.ts
â”‚       â”‚   â”œâ”€â”€ de.ts
â”‚       â”‚   â””â”€â”€ zh.ts
â”‚       â””â”€â”€ main.ts                   # i18n setup
â”‚
â””â”€â”€ apps/student-teacher/             # Nuxt 4 app
    â”œâ”€â”€ locales/                      # Translation files
    â”‚   â”œâ”€â”€ en.ts
    â”‚   â”œâ”€â”€ es.ts
    â”‚   â”œâ”€â”€ ar.ts
    â”‚   â”œâ”€â”€ fr.ts
    â”‚   â”œâ”€â”€ de.ts
    â”‚   â””â”€â”€ zh.ts
    â”œâ”€â”€ plugins/i18n-rtl.ts           # RTL plugin
    â””â”€â”€ nuxt.config.ts                # i18n configuration
```

### Supported Locales

| Code | Language | Direction | Flag | Language Tag |
| ---- | -------- | --------- | ---- | ------------ |
| `en` | English  | LTR       | ğŸ‡ºğŸ‡¸   | en-US        |
| `es` | EspaÃ±ol  | LTR       | ğŸ‡ªğŸ‡¸   | es-ES        |
| `ar` | Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©  | RTL       | ğŸ‡¸ğŸ‡¦   | ar-SA        |
| `fr` | FranÃ§ais | LTR       | ğŸ‡«ğŸ‡·   | fr-FR        |
| `de` | Deutsch  | LTR       | ğŸ‡©ğŸ‡ª   | de-DE        |
| `zh` | ä¸­æ–‡     | LTR       | ğŸ‡¨ğŸ‡³   | zh-CN        |

---

## Basic Usage

### 1. Using Translations in Components

#### Vue 3 (Institutional App)

```vue
<template>
  <div>
    <!-- Simple translation -->
    <h1>{{ $t("common.welcome") }}</h1>

    <!-- Translation with parameters -->
    <p>{{ $t("common.greeting", { name: userName }) }}</p>

    <!-- Pluralization -->
    <span>{{ $tc("common.items", itemCount) }}</span>
  </div>
</template>

<script setup lang="ts">
  import { useI18n } from "vue-i18n";

  const { t, locale } = useI18n();

  // Using t() function in script
  const message = t("common.save");
  console.log("Current locale:", locale.value);
</script>
```

#### Nuxt 4 (Student-Teacher App)

```vue
<template>
  <div>
    <!-- Simple translation -->
    <h1>{{ $t("common.welcome") }}</h1>

    <!-- Translation with parameters -->
    <p>{{ $t("common.greeting", { name: userName }) }}</p>
  </div>
</template>

<script setup lang="ts">
  const { t, locale } = useI18n();

  // Using t() function
  const message = t("common.save");
</script>
```

### 2. Switching Languages

#### Using the LanguageSelector Component

Both apps include a `LanguageSelector` component:

```vue
<template>
  <LanguageSelector />
</template>
```

#### Programmatic Language Switch

```typescript
import { useI18n } from "vue-i18n"; // or useI18n from '#imports' in Nuxt

const { locale } = useI18n();

// Switch to Spanish
locale.value = "es";

// Switch to Arabic (RTL)
locale.value = "ar";
```

### 3. Accessing Locale Configuration

```typescript
import { SUPPORTED_LOCALES, DEFAULT_LOCALE } from "@lq/i18n";

console.log(SUPPORTED_LOCALES);
// [
//   { code: 'en', name: 'English', flag: 'ğŸ‡ºğŸ‡¸', dir: 'ltr', language: 'en-US' },
//   { code: 'es', name: 'EspaÃ±ol', flag: 'ğŸ‡ªğŸ‡¸', dir: 'ltr', language: 'es-ES' },
//   ...
// ]

console.log(DEFAULT_LOCALE); // 'en'
```

---

## Medium Usage

### 1. RTL Support

The system automatically handles RTL (Right-to-Left) languages like Arabic.

#### Automatic RTL Switching (Nuxt)

The `i18n-rtl.ts` plugin automatically sets document direction:

```typescript
// plugins/i18n-rtl.ts (already configured)
export default defineNuxtPlugin((nuxtApp) => {
  const { $i18n } = nuxtApp;

  $i18n.onBeforeLanguageSwitch = (oldLocale, newLocale) => {
    setDocumentDir(newLocale);
  };
});
```

#### Manual RTL Handling

```typescript
import { isRTL, setDocumentDir, getDirection } from "@lq/i18n";

// Check if locale is RTL
if (isRTL("ar")) {
  console.log("Arabic is RTL");
}

// Set document direction
setDocumentDir("ar"); // Sets <html dir="rtl" lang="ar">

// Get direction for a locale
const direction = getDirection("ar"); // 'rtl'
```

#### RTL-Aware Styling

```vue
<template>
  <div :class="{ 'rtl-layout': isRTL(locale) }">
    <p>Content adapts to text direction</p>
  </div>
</template>

<script setup lang="ts">
  import { isRTL } from "@lq/i18n";
  import { useI18n } from "vue-i18n";

  const { locale } = useI18n();
</script>

<style scoped>
  .rtl-layout {
    direction: rtl;
    text-align: right;
  }
</style>
```

### 2. Locale Persistence

User language preferences are automatically saved and restored.

#### Using Persistence Utilities

```typescript
import { saveLocale, loadLocale, clearLocale } from "@lq/i18n";

// Save user's locale preference
saveLocale("es"); // Saves to localStorage

// Load saved locale
const savedLocale = loadLocale(); // Returns 'es' or null

// Clear saved locale
clearLocale();
```

#### Cookie-Based Persistence (Nuxt)

Nuxt automatically uses cookies for SSR compatibility:

```typescript
// nuxt.config.ts (already configured)
i18n: {
  detectBrowserLanguage: {
    useCookie: true,
    cookieKey: 'lq_locale',
    redirectOn: 'root',
  },
}
```

Manual cookie operations:

```typescript
import { saveLocaleToCookie, loadLocaleFromCookie } from "@lq/i18n";

// Save to cookie (expires in 365 days by default)
saveLocaleToCookie("es", 365);

// Load from cookie
const locale = loadLocaleFromCookie(); // Returns 'es' or null
```

### 3. Translation File Structure

Each locale file exports a nested object:

```typescript
// locales/en.ts
export default {
  common: {
    welcome: "Welcome",
    save: "Save",
    cancel: "Cancel",
    loading: "Loading...",
  },
  auth: {
    login: "Log In",
    logout: "Log Out",
    email: "Email",
    password: "Password",
  },
  dashboard: {
    title: "Dashboard",
    stats: {
      users: "Total Users",
      active: "Active Sessions",
    },
  },
};
```

Access nested keys with dot notation:

```vue
<template>
  <h1>{{ $t("dashboard.title") }}</h1>
  <p>{{ $t("dashboard.stats.users") }}</p>
</template>
```

### 4. Translation with Parameters

```typescript
// locales/en.ts
export default {
  common: {
    greeting: "Hello, {name}!",
    itemCount: "You have {count} items",
    dateMessage: "Today is {date}",
  },
};
```

```vue
<template>
  <p>{{ $t("common.greeting", { name: "John" }) }}</p>
  <p>{{ $t("common.itemCount", { count: 5 }) }}</p>
  <p>{{ $t("common.dateMessage", { date: new Date().toLocaleDateString() }) }}</p>
</template>
```

### 5. Pluralization

Vue i18n v10 supports pluralization using the pipe `|` separator.

#### Basic Pluralization

```typescript
// locales/en.ts
export default {
  common: {
    items: "no items | one item | {count} items",
    apples: "no apples | one apple | {n} apples",
  },
};
```

```vue
<template>
  <!-- Using count parameter -->
  <p>{{ $t("common.items", 0) }}</p>
  <!-- "no items" -->
  <p>{{ $t("common.items", 1) }}</p>
  <!-- "one item" -->
  <p>{{ $t("common.items", 5) }}</p>
  <!-- "5 items" -->

  <!-- Using named parameter -->
  <p>{{ $t("common.apples", { n: 0 }) }}</p>
  <!-- "no apples" -->
  <p>{{ $t("common.apples", { n: 1 }) }}</p>
  <!-- "one apple" -->
  <p>{{ $t("common.apples", { n: 10 }) }}</p>
  <!-- "10 apples" -->
</template>
```

#### Pluralization Rules

Vue i18n v10 uses the following format:

```
'form_0 | form_1 | form_2 | ... | form_n'
```

- **0**: Zero form (optional)
- **1**: Singular form
- **2+**: Plural form

**Examples**:

```typescript
// Two forms (singular | plural)
messages: "no messages | {count} message | {count} messages";

// Simple form (singular | plural)
car: "car | cars";

// With zero form
notification: "no notifications | one notification | {n} notifications";
```

#### Language-Specific Pluralization

Different languages have different plural rules:

**English** (2 forms):

```typescript
item: "no items | one item | {count} items";
```

**Spanish** (2 forms):

```typescript
item: "ningÃºn elemento | un elemento | {count} elementos";
```

**Arabic** (6 forms - complex):

```typescript
// Arabic has: zero, one, two, few, many, other
item: "Ù„Ø§ Ø¹Ù†Ø§ØµØ± | Ø¹Ù†ØµØ± ÙˆØ§Ø­Ø¯ | Ø¹Ù†ØµØ±Ø§Ù† | {count} Ø¹Ù†Ø§ØµØ± | {count} Ø¹Ù†ØµØ±Ù‹Ø§ | {count} Ø¹Ù†ØµØ±";
```

**Note**: For complex plural rules like Arabic, consider using the full plural format or consult
[Unicode CLDR](https://cldr.unicode.org/index/cldr-spec/plural-rules).

#### In Script

```typescript
import { useI18n } from "vue-i18n";

const { t } = useI18n();

// Using pluralization in script
const itemCount = 5;
const message = t("common.items", itemCount);
console.log(message); // "5 items"

// With named parameters
const appleCount = 1;
const appleMessage = t("common.apples", { n: appleCount });
console.log(appleMessage); // "one apple"
```

#### Best Practices for Pluralization

1. **Always provide at least 2 forms**: singular and plural
2. **Use named parameters** (`{n}`, `{count}`) for clarity
3. **Test with 0, 1, and multiple values**
4. **Consider language-specific rules** for non-English locales
5. **Document complex plural rules** in comments

---

## Advanced Usage

### 1. Custom Locale Switching Composable

The `@lq/i18n` package provides a Vue composable for advanced locale management:

```typescript
import { useLocaleSwitch } from "@lq/i18n";

const {
  currentLocale, // Ref<SupportedLocale>
  availableLocales, // ComputedRef<LocaleConfig[]>
  switchLocale, // (locale: SupportedLocale) => void
  getCurrentLocaleConfig, // () => LocaleConfig | undefined
} = useLocaleSwitch();

// Switch locale
switchLocale("fr");

// Get current locale config
const config = getCurrentLocaleConfig();
console.log(config?.name); // 'FranÃ§ais'
console.log(config?.flag); // 'ğŸ‡«ğŸ‡·'

// List all available locales
console.log(availableLocales.value);
```

### 2. Adding a New Language

#### Step 1: Update Shared Configuration

```typescript
// packages/i18n/src/config.ts
export const SUPPORTED_LOCALES = [
  // ... existing locales
  {
    code: "pt",
    name: "PortuguÃªs",
    dir: "ltr",
    flag: "ğŸ‡§ğŸ‡·",
    language: "pt-BR",
  },
] as const;
```

#### Step 2: Create Translation Files

**Institutional App:**

```typescript
// apps/institutional/src/locales/pt.ts
export default {
  common: {
    welcome: "Bem-vindo",
    save: "Salvar",
    cancel: "Cancelar",
  },
  // ... all other namespaces
};
```

**Student-Teacher App:**

```typescript
// apps/student-teacher/locales/pt.ts
export default {
  common: {
    welcome: "Bem-vindo",
    save: "Salvar",
    cancel: "Cancelar",
  },
  // ... all other namespaces
};
```

#### Step 3: Register in App Configurations

**Institutional App (`main.ts`):**

```typescript
import pt from "./locales/pt";

const i18n = createI18n({
  locale: loadedLocale || DEFAULT_LOCALE,
  fallbackLocale: FALLBACK_LOCALE,
  messages: {
    en,
    es,
    ar,
    fr,
    de,
    zh,
    pt, // Add new locale
  },
});
```

**Student-Teacher App (`nuxt.config.ts`):**

```typescript
i18n: {
  locales: [
    // ... existing locales
    {
      code: 'pt',
      language: 'pt-BR',
      name: 'PortuguÃªs',
      file: 'pt.ts',
    },
  ],
}
```

### 3. Lazy Loading Translations (Nuxt)

Nuxt automatically lazy-loads translations for better performance:

```typescript
// nuxt.config.ts
i18n: {
  lazy: true,
  langDir: 'locales',
  locales: [
    { code: 'en', file: 'en.ts' },
    { code: 'es', file: 'es.ts' },
    // ... other locales
  ],
}
```

Translation files are only loaded when the user switches to that language.

### 4. Type-Safe Translations

#### Generate TypeScript Types

```bash
# From monorepo root
pnpm i18n:types
```

This generates type definitions based on your English translation file (source of truth).

#### Using Generated Types

```typescript
import type { MessageSchema } from "@lq/i18n";

// Type-safe translation keys
const key: keyof MessageSchema = "common.welcome";

// TypeScript will error if key doesn't exist
const translation = t("common.nonexistent"); // âŒ Type error
```

### 5. Translation Validation

Ensure all locales have the same keys:

```bash
# From monorepo root
pnpm i18n:validate
```

This script:

- Compares all locale files against English (source)
- Reports missing keys
- Reports extra keys
- Checks for empty translations

### 6. Custom i18n Plugin (Nuxt)

Create custom plugins to extend i18n functionality:

```typescript
// plugins/i18n-custom.ts
export default defineNuxtPlugin((nuxtApp) => {
  const { $i18n } = nuxtApp;

  // Add custom methods
  $i18n.formatCurrency = (amount: number) => {
    const locale = $i18n.locale.value;
    return new Intl.NumberFormat(locale, {
      style: "currency",
      currency: "USD",
    }).format(amount);
  };

  // Add custom date formatting
  $i18n.formatDate = (date: Date) => {
    const locale = $i18n.locale.value;
    return new Intl.DateTimeFormat(locale).format(date);
  };
});
```

Usage:

```vue
<template>
  <p>{{ $i18n.formatCurrency(1234.56) }}</p>
  <p>{{ $i18n.formatDate(new Date()) }}</p>
</template>
```

### 7. SEO and Meta Tags (Nuxt)

Configure SEO for different languages:

```typescript
// nuxt.config.ts
i18n: {
  baseUrl: 'https://lingoquesto.com',
  locales: [
    {
      code: 'en',
      iso: 'en-US',
      file: 'en.ts',
    },
    {
      code: 'es',
      iso: 'es-ES',
      file: 'es.ts',
    },
  ],
}
```

In components:

```vue
<script setup lang="ts">
  const { t } = useI18n();

  useSeoMeta({
    title: t("seo.title"),
    description: t("seo.description"),
    ogTitle: t("seo.ogTitle"),
    ogDescription: t("seo.ogDescription"),
  });
</script>
```

---

## Scripts & Tooling

### Available Scripts

Run from monorepo root:

```bash
# Generate TypeScript types from translations
pnpm i18n:types

# Validate all translations (check for missing/extra keys)
pnpm i18n:validate

# Extract translation keys from source code
pnpm i18n:extract

# Run unit tests for i18n utilities
pnpm test:unit packages/i18n
```

### Script Details

#### 1. `i18n:types` - Generate TypeScript Types

**Purpose**: Generate type-safe translation keys based on English locale.

**Usage**:

```bash
pnpm i18n:types
```

**Output**: Creates `packages/i18n/src/types.generated.ts`

**What it generates**:

- Union type of all translation keys
- Constant array of keys for runtime validation
- Type count export

**Example output**:

```
ğŸ” Loading English translations...
ğŸ“ Generating TypeScript types...
ğŸ’¾ Writing types to file...
âœ… Successfully generated types for 130 translation keys
ğŸ“„ Output: packages/i18n/src/types.generated.ts
```

**Generated types**:

```typescript
export type TranslationKey = "common.save" | "common.cancel" | "auth.login" | "auth.logout";
// ... 130 keys total

export const TRANSLATION_KEYS = [
  "common.save",
  "common.cancel",
  // ...
] as const;

export type TranslationKeyCount = 130;
```

**Usage in code**:

```typescript
import type { TranslationKey } from "@lq/i18n";

// TypeScript will error if key doesn't exist
const key: TranslationKey = "common.save"; // âœ… Valid
const invalid: TranslationKey = "nonexistent"; // âŒ Type error
```

#### 2. `i18n:validate` - Validate Translations

**Purpose**: Ensure all locales have consistent keys.

**Usage**:

```bash
pnpm i18n:validate
```

**Checks**:

- Missing keys in non-English locales
- Extra keys not present in English
- Empty translation values
- Structural differences

**Real output example**:

```
ğŸ” Validating translations...

============================================================
ğŸ“± App: INSTITUTIONAL
============================================================

ğŸ“Š Base locale (en): 130 keys

ğŸŒ Locale: ES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… All translations complete!

ğŸŒ Locale: AR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… All translations complete!

ğŸŒ Locale: FR
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… All translations complete!

============================================================
ğŸ“± App: STUDENT-TEACHER
============================================================

ğŸ“Š Base locale (en): 141 keys

ğŸŒ Locale: ES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… All translations complete!

==================================================
ğŸ“‹ Summary:
==================================================
âœ… All translations are valid!
```

**Error detection example**:

```
ğŸŒ Locale: ES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âŒ Missing keys (2):
   - common.newFeature
   - dashboard.stats.newMetric

âš ï¸  Pending translations (3):
   - auth.resetPassword
   - teacher.scenarios.createNew
   - student.dashboard.welcome
```

#### 3. `i18n:extract` - Extract Translation Keys

**Purpose**: Find all translation keys used in source code.

**Usage**:

```bash
pnpm i18n:extract
```

**What it does**:

1. Scans all `.vue`, `.ts`, `.js` files in both apps
2. Extracts `$t('key')` from Vue templates
3. Extracts `t('key')` from script sections
4. Adds missing keys to all locale files with `[MISSING]` marker
5. Safe to run multiple times (idempotent)

**Real output example**:

```
ğŸš€ Starting translation key extraction...

ğŸ” Scanning files for translation keys...

âœ… Found 152 translation calls (93 unique keys)

ğŸ“ Updating translation files...

ğŸ“± Updating institutional...

ğŸ“± Updating student-teacher...

ğŸ“Š Summary:

  institutional:
    EN: 9 new keys added
    ES: 9 new keys added
    AR: 9 new keys added
    FR: 9 new keys added
    DE: 9 new keys added
    ZH: 9 new keys added

  student-teacher:
    EN: 3 new keys added
    ES: 3 new keys added
    AR: 3 new keys added
    FR: 3 new keys added
    DE: 3 new keys added
    ZH: 3 new keys added

âœ… Extraction complete!
```

**How it marks new keys**:

```typescript
// In en.ts
export default {
  myFeature: {
    newKey: "[MISSING] myFeature.newKey",
  },
};

// In es.ts
export default {
  myFeature: {
    newKey: "[TODO-ES] myFeature.newKey",
  },
};
```

### VSCode i18n Ally Extension

**Recommended**: Install [i18n Ally](https://marketplace.visualstudio.com/items?itemName=Lokalise.i18n-ally) for inline
translation editing.

**Configuration** (`.vscode/settings.json`):

```json
{
  "i18n-ally.localesPaths": ["apps/institutional/src/locales", "apps/student-teacher/locales"],
  "i18n-ally.keystyle": "nested",
  "i18n-ally.enabledFrameworks": ["vue", "vue-sfc"],
  "i18n-ally.sourceLanguage": "en",
  "i18n-ally.displayLanguage": "en",
  "i18n-ally.enabledParsers": ["ts", "js"]
}
```

**Features**:

- Inline translation preview
- Missing translation warnings
- Quick translation editing
- Translation key autocomplete

### Unit Testing

The i18n package includes comprehensive unit tests to ensure reliability.

**Run tests**:

```bash
pnpm test:unit packages/i18n
```

**Test coverage**:

- âœ… **60 tests** across 3 test suites
- âœ… **100% passing** (2.45s execution time)

**Test suites**:

#### 1. `config.test.ts` (22 tests)

Tests for i18n configuration:

- Validates all 6 supported locales
- Checks locale properties (code, name, dir, flag, language)
- Verifies default and fallback locales
- Ensures unique locale codes
- Tests TypeScript type definitions

#### 2. `persistence.test.ts` (20 tests)

Tests for locale persistence:

- **LocalStorage**: save, load, clear operations
- **Cookies**: save with expiry, load operations
- **Integration**: both storage methods working independently
- **Edge cases**: empty values, overwrites, switching

#### 3. `rtl.test.ts` (18 tests)

Tests for RTL support:

- `isRTL()` for all locales (Arabic = true, others = false)
- `getDirection()` returns 'ltr' or 'rtl'
- `setDocumentDir()` updates DOM correctly
- Switching between LTR â†” RTL

**Example test output**:

```
 DEV  v2.1.9 D:/Dev/Projects/LingoQuesto/frontend-lq

 âœ“ packages/i18n/src/__tests__/config.test.ts (22)
 âœ“ packages/i18n/src/__tests__/persistence.test.ts (20)
 âœ“ packages/i18n/src/__tests__/rtl.test.ts (18)

 Test Files  3 passed (3)
      Tests  60 passed (60)
   Start at  02:32:34
   Duration  2.45s
```

**Test files location**: `packages/i18n/src/__tests__/`

---

## Best Practices

### 1. Translation Key Naming

**Use descriptive, hierarchical keys**:

âœ… Good:

```typescript
{
  dashboard: {
    stats: {
      totalUsers: 'Total Users',
      activeUsers: 'Active Users',
    },
  },
}
```

âŒ Bad:

```typescript
{
  dash_stat_1: 'Total Users',
  dash_stat_2: 'Active Users',
}
```

### 2. Keep English as Source of Truth

- Always add new keys to English first
- Use English keys as the reference for all other locales
- Run `pnpm i18n:validate` regularly

### 3. Avoid Hardcoded Strings

âŒ Bad:

```vue
<template>
  <button>Save</button>
</template>
```

âœ… Good:

```vue
<template>
  <button>{{ $t("common.save") }}</button>
</template>
```

### 4. Use Namespaces for Organization

Group related translations:

```typescript
{
  auth: { /* authentication translations */ },
  dashboard: { /* dashboard translations */ },
  errors: { /* error messages */ },
  validation: { /* form validation */ },
}
```

### 5. Test RTL Languages

Always test Arabic (RTL) separately:

- Check layout alignment
- Verify icon positions
- Test navigation flow
- Validate form layouts

### 6. Sync Translations Between Apps

Since apps manage their own translations, keep them synchronized:

1. Make changes in one app
2. Copy to other apps
3. Run validation: `pnpm i18n:validate`

**Consider creating a sync script**:

```bash
# scripts/sync-translations.sh
cp apps/institutional/src/locales/*.ts apps/student-teacher/locales/
```

### 7. Use Parameters for Dynamic Content

âŒ Bad:

```typescript
const message = `Hello, ${userName}!`;
```

âœ… Good:

```typescript
const message = t("common.greeting", { name: userName });
```

### 8. Lazy Load Large Translation Files

For apps with many translations, split into smaller files:

```typescript
// locales/en/index.ts
export default {
  common: () => import("./common"),
  dashboard: () => import("./dashboard"),
  auth: () => import("./auth"),
};
```

### 9. Document Translation Context

Add comments for translators:

```typescript
{
  // Greeting shown on the homepage hero section
  welcome: 'Welcome to LingoQuesto',

  // Button text for submitting a form
  submit: 'Submit',

  // Error message when network request fails
  networkError: 'Network error. Please try again.',
}
```

---

## Troubleshooting

### Problem: Translations Not Loading

**Symptoms**: Seeing translation keys instead of actual text (e.g., `common.welcome` instead of "Welcome").

**Solutions**:

1. **Check locale file exists**:

   ```bash
   # Institutional
   ls apps/institutional/src/locales/en.ts

   # Student-Teacher
   ls apps/student-teacher/locales/en.ts
   ```

2. **Verify locale is registered**:

   ```typescript
   // Check main.ts or nuxt.config.ts
   console.log(i18n.availableLocales);
   ```

3. **Check for syntax errors in locale file**:
   ```bash
   # Run TypeScript check
   pnpm tsc --noEmit
   ```

### Problem: RTL Not Working

**Symptoms**: Arabic text displays left-to-right or layout doesn't flip.

**Solutions**:

1. **Verify RTL plugin is loaded (Nuxt)**:

   ```typescript
   // Check plugins/i18n-rtl.ts exists
   // Check it's not disabled in nuxt.config.ts
   ```

2. **Check document direction**:

   ```javascript
   console.log(document.documentElement.dir); // Should be 'rtl'
   console.log(document.documentElement.lang); // Should be 'ar'
   ```

3. **Add RTL-specific styles**:
   ```css
   [dir="rtl"] .my-component {
     text-align: right;
     direction: rtl;
   }
   ```

### Problem: Locale Not Persisting

**Symptoms**: Language resets to default on page reload.

**Solutions**:

1. **Check localStorage**:

   ```javascript
   console.log(localStorage.getItem("lq_locale"));
   ```

2. **Check cookies (Nuxt)**:

   ```javascript
   console.log(document.cookie);
   // Should contain: lq_locale=es
   ```

3. **Verify persistence is enabled**:
   ```typescript
   // Institutional: Check main.ts has watch for locale changes
   // Student-Teacher: Check nuxt.config.ts has detectBrowserLanguage
   ```

### Problem: Missing Translations in Production

**Symptoms**: Translations work in development but not in production build.

**Solutions**:

1. **Check build includes locale files**:

   ```bash
   # After build, check dist folder
   ls dist/locales/
   ```

2. **Verify lazy loading paths (Nuxt)**:

   ```typescript
   // nuxt.config.ts
   i18n: {
     langDir: 'locales', // Must match actual directory
   }
   ```

3. **Check for build errors**:
   ```bash
   pnpm build
   # Look for i18n-related errors
   ```

### Problem: Type Errors with Translation Keys

**Symptoms**: TypeScript errors when using `t()` function.

**Solutions**:

1. **Regenerate types**:

   ```bash
   pnpm i18n:types
   ```

2. **Check tsconfig includes generated types**:

   ```json
   {
     "include": ["packages/i18n/src/types/**/*"]
   }
   ```

3. **Restart TypeScript server** in VSCode:
   - `Cmd/Ctrl + Shift + P`
   - "TypeScript: Restart TS Server"

### Problem: i18n Ally Not Working

**Symptoms**: VSCode extension doesn't show translations.

**Solutions**:

1. **Check extension settings**:

   ```json
   // .vscode/settings.json
   {
     "i18n-ally.localesPaths": ["apps/institutional/src/locales", "apps/student-teacher/locales"]
   }
   ```

2. **Reload VSCode window**:
   - `Cmd/Ctrl + Shift + P`
   - "Developer: Reload Window"

3. **Check locale file format**:
   - Must be `.ts` or `.js`
   - Must export default object
   - Must use supported structure

### Problem: Translations Out of Sync

**Symptoms**: Different translations between apps or missing keys.

**Solutions**:

1. **Run validation**:

   ```bash
   pnpm i18n:validate
   ```

2. **Compare locale files**:

   ```bash
   diff apps/institutional/src/locales/en.ts apps/student-teacher/locales/en.ts
   ```

3. **Create sync script** (see Best Practices section)

---

## Additional Resources

- **Vue i18n Documentation**: https://vue-i18n.intlify.dev/
- **Nuxt i18n Module**: https://i18n.nuxtjs.org/
- **i18n Ally Extension**: https://github.com/lokalise/i18n-ally
- **RTL Best Practices**: https://rtlstyling.com/

---

## Summary

### Implementation Status âœ…

The i18n system is **fully implemented and production-ready**:

| Feature            | Status      | Details                                     |
| ------------------ | ----------- | ------------------------------------------- |
| **Multi-language** | âœ… Complete | 6 languages (EN, ES, AR, FR, DE, ZH)        |
| **Type Safety**    | âœ… Complete | Auto-generated TypeScript types             |
| **Automation**     | âœ… Complete | Key extraction, validation, type generation |
| **RTL Support**    | âœ… Complete | Automatic switching for Arabic              |
| **Persistence**    | âœ… Complete | localStorage + cookies                      |
| **Hot Reload**     | âœ… Complete | Vite HMR + Nuxt HMR                         |
| **Unit Tests**     | âœ… Complete | 60 tests, 100% passing                      |
| **Documentation**  | âœ… Complete | Comprehensive guides                        |

### Translation Coverage

- **Institutional App**: 130 keys Ã— 6 languages = **780 translations** âœ…
- **Student-Teacher App**: 141 keys Ã— 6 languages = **846 translations** âœ…
- **Total**: **1,626 translations**, 100% complete

### Available Scripts

```bash
# Generate TypeScript types
pnpm i18n:types

# Extract keys from code
pnpm i18n:extract

# Validate translations
pnpm i18n:validate

# Run unit tests
pnpm test:unit packages/i18n
```

### Quick Reference

**Switch Language**:

```typescript
locale.value = "es";
```

**Use Translation**:

```vue
{{ $t("common.welcome") }}
```

**Check RTL**:

```typescript
isRTL("ar"); // true
```

**Save Locale**:

```typescript
saveLocale("fr");
```

**Add New Keys**:

```bash
# 1. Use key in code: $t('myFeature.newKey')
# 2. Extract keys
pnpm i18n:extract
# 3. Translate [MISSING] markers
# 4. Validate
pnpm i18n:validate
```

### Key Files

**Configuration**:

- `packages/i18n/src/config.ts` - Locale configuration
- `packages/i18n/src/types.generated.ts` - Generated TypeScript types

**App Setup**:

- `apps/institutional/src/main.ts` - Vue i18n setup
- `apps/student-teacher/nuxt.config.ts` - Nuxt i18n config
- `apps/student-teacher/plugins/i18n-rtl.ts` - RTL plugin

**Translations**:

- `apps/institutional/src/locales/` - Institutional translations
- `apps/student-teacher/locales/` - Student-Teacher translations

**Testing**:

- `packages/i18n/src/__tests__/` - Unit tests (60 tests)

**Scripts**:

- `packages/i18n/scripts/generate-types.ts` - Type generation
- `packages/i18n/scripts/extract-keys.ts` - Key extraction
- `packages/i18n/scripts/validate-translations.ts` - Validation

**Tools**:

- `.vscode/settings.json` - i18n Ally configuration

### What Makes This Special

1. **Hybrid Architecture**: Shared utilities + app-managed translations
2. **Full Automation**: Extract, validate, generate types - all automated
3. **Type Safety**: Compile-time validation of translation keys
4. **RTL First-Class**: Not an afterthought, fully integrated
5. **Developer Experience**: Hot reload, autocomplete, clear errors
6. **Well Tested**: 60 tests covering all critical functionality
7. **Thoroughly Documented**: From basic to advanced usage

---

**Need Help?** Check the [Troubleshooting](#troubleshooting) section or refer to the `@lq/i18n` package
[README](../packages/i18n/README.md).
