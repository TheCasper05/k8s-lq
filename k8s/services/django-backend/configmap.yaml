# ==============================================================================
# CONFIGMAP: Django Backend - Configuration
# ==============================================================================
# Variables de entorno públicas para Django.
# ==============================================================================

apiVersion: v1
kind: ConfigMap
metadata:
  name: django-backend-config
  namespace: lingoquesto
  labels:
    app: django-backend
    component: api
data:
  # ============================================================================
  # Environment
  # ============================================================================
  ENVIRONMENT: "development"
  DEBUG: "True"  # True para desarrollo local/Minikube
  ALLOWED_HOSTS: "*"  # En producción, especifica dominios exactos

  # ============================================================================
  # Database
  # ============================================================================
  # URL se construye con valores del Secret
  # postgresql://user:password@host:port/database
  DATABASE_URL: "postgresql://$(POSTGRES_USER):$(POSTGRES_PASSWORD)@postgres:5432/$(POSTGRES_DB)?sslmode=disable&options=-c%20search_path%3Dlq"

  # ============================================================================
  # Redis
  # ============================================================================
  REDIS_URL: "redis://redis:6379/0"
  REDIS_CACHE_URL: "redis://redis:6379/1"

  # ============================================================================
  # Static & Media Files
  # ============================================================================
  STATIC_ROOT: "static/"
  STATIC_URL: "/static/"
  MEDIA_ROOT: "media/"
  MEDIA_URL: "/media/"

  # ============================================================================
  # Storage Backend
  # ============================================================================
  # Usa FileSystemStorage para desarrollo
  # En producción, cambia a S3/DigitalOcean Spaces
  STORAGES_DEFAULT_BACKEND: "django.core.files.storage.FileSystemStorage"

  # S3/DigitalOcean Spaces Configuration (si lo usas)
  AWS_STORAGE_BUCKET_NAME: "lq-storage-qa"
  AWS_DEFAULT_ACL: "public-read"
  AWS_S3_ENDPOINT_URL: "https://nyc3.digitaloceanspaces.com"

  # ============================================================================
  # Frontend & WebSocket URLs
  # ============================================================================
  # URLs de los frontends (para CORS y redirects)
  ENDPOINT_URL_FRONTEND: "http://frontend-student-teacher:3000"
  ENDPOINT_URL_FRONTEND_ST: "http://frontend-student-teacher:3000"
  WEBSOCKET_URL: "ws://django-backend:8000"

  # ============================================================================
  # CORS Configuration
  # ============================================================================
  # Orígenes permitidos para CORS
  CORS_ALLOWED_ORIGINS: "http://frontend-student-teacher:3000,http://localhost:3000,http://localhost:5173"
  CSRF_TRUSTED_ORIGINS: "http://frontend-student-teacher:3000,http://localhost:3000,http://localhost:5173"

  # ============================================================================
  # HTTPS Settings (producción)
  # ============================================================================
  SECURE_SSL_REDIRECT: "False"  # Cambiar a True si usas HTTPS
  SECURE_HSTS_SECONDS: "0"
  SECURE_HSTS_INCLUDE_SUBDOMAINS: "False"
  SECURE_HSTS_PRELOAD: "False"

  # ============================================================================
  # Email Configuration
  # ============================================================================
  # Console mail para desarrollo
  # En producción, usa SMTP real
  EMAIL_URL: "consolemail://user:password@localhost:25"
  DEFAULT_FROM_EMAIL: "support@lingoquesto.com"

  # ============================================================================
  # External Services
  # ============================================================================
  # LingoBot Service (interno)
  LINGOBOT_ADDRESS: "http://fastapi-bot:8081"

  # Unsplash API
  UNSPLASH_URL: "https://api.unsplash.com"

  # ============================================================================
  # JWT Configuration for Realtime Service
  # ============================================================================
  REALTIME_JWT_ALGORITHM: "HS256"
  REALTIME_JWT_EXPIRATION_MINUTES: "10"

  # ============================================================================
  # Development & Debugging
  # ============================================================================
  NPLUSONE_RAISE: "False"
  HEADLESS_SERVE_SPECIFICATION: "True"

  # ============================================================================
  # Monitoring (opcional)
  # ============================================================================
  # Sentry DSN (deja vacío si no usas Sentry)
  SENTRY_DSN: ""

# ==============================================================================
# Nota sobre DATABASE_URL:
# La variable usa $(POSTGRES_USER), $(POSTGRES_PASSWORD), $(POSTGRES_DB)
# Estos se expanden desde el Secret en el Deployment
# ==============================================================================
